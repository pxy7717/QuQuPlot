<Window x:Class="QuquPlot.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:QuquPlot"
        xmlns:scott="clr-namespace:ScottPlot.WPF;assembly=ScottPlot.WPF"
        xmlns:system="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="{DynamicResource WindowTitle}" Height="700" Width="1300"
        Icon="pack://application:,,,/assets/logo.png"
        FontFamily="Microsoft YaHei">
    <Window.Resources>
        <ResourceDictionary>
            <system:Double x:Key="IconSize">32</system:Double>
            <system:Double x:Key="ButtonPadding">5</system:Double>
            <system:Double x:Key="CurveRowHeight">30</system:Double>
            
            <!-- 工具栏按钮样式 -->
            <Style x:Key="ToolbarButtonStyle" TargetType="Button">
                <Setter Property="Padding" Value="{StaticResource ButtonPadding}"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}">
                                <ContentPresenter x:Name="PART_ContentPresenter"
                                                HorizontalAlignment="Center" 
                                                VerticalAlignment="Center">
                                    <ContentPresenter.ContentTemplate>
                                        <DataTemplate>
                                            <Image Source="{Binding Source}"
                                                   Width="{StaticResource IconSize}"
                                                   Height="{StaticResource IconSize}"
                                                   RenderOptions.BitmapScalingMode="HighQuality"
                                                   Opacity="0.9"/>
                                        </DataTemplate>
                                    </ContentPresenter.ContentTemplate>
                                </ContentPresenter>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="PART_ContentPresenter" Property="Opacity" Value="1"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 高亮按钮样式 -->
            <Style x:Key="HighlightedButtonStyle" TargetType="Button" BasedOn="{StaticResource ToolbarButtonStyle}">
                <Setter Property="Background" Value="#E0E0E0"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}">
                                <ContentPresenter x:Name="PART_ContentPresenter"
                                                HorizontalAlignment="Center" 
                                                VerticalAlignment="Center">
                                    <ContentPresenter.ContentTemplate>
                                        <DataTemplate>
                                            <Image Source="{Binding Source}"
                                                   Width="{StaticResource IconSize}"
                                                   Height="{StaticResource IconSize}"
                                                   RenderOptions.BitmapScalingMode="HighQuality"
                                                   Opacity="1"/>
                                        </DataTemplate>
                                    </ContentPresenter.ContentTemplate>
                                </ContentPresenter>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#D0D0D0"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ListView 样式 -->
            <Style TargetType="ListViewItem">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Height" Value="{StaticResource CurveRowHeight}"/>
                <Setter Property="Margin" Value="0,2,0,2"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ListViewItem">
                            <Grid>
                                <!-- 阴影/高亮背景层 -->
                                <Border x:Name="ShadowBg" Margin="5,1,5,1" Background="#FFF0F0F0" CornerRadius="2">
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="4" ShadowDepth="2" Opacity="0.18"/>
                                    </Border.Effect>
                                </Border>
                                <!-- 内容层 -->
                                <Border Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        CornerRadius="6">
                                    <GridViewRowPresenter Height="{StaticResource CurveRowHeight}"/>
                                </Border>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="Transparent"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#F0F0F0"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 表头样式 -->
            <Style TargetType="GridViewColumnHeader">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Padding" Value="5,2"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="GridViewColumnHeader">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Content, RelativeSource={RelativeSource Self}}" Value="{x:Null}">
                        <Setter Property="IsHitTestVisible" Value="True"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Content, RelativeSource={RelativeSource Self}}" Value="">
                        <Setter Property="IsHitTestVisible" Value="True"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!-- ListView 表头容器样式 -->
            <Style TargetType="ListView">
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Background" Value="Transparent"/>
            </Style>

            <!-- Slider 样式 -->
            <Style TargetType="Slider">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Slider">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <!-- TickBar（刻度）-->
                                <TickBar x:Name="TopTick"
                                         Visibility="Collapsed"
                                         Fill="#888"
                                         Placement="Top"
                                         Height="4"
                                         SnapsToDevicePixels="True"
                                         Minimum="{TemplateBinding Minimum}"
                                         Maximum="{TemplateBinding Maximum}"
                                         TickFrequency="{TemplateBinding TickFrequency}"
                                         IsDirectionReversed="{TemplateBinding IsDirectionReversed}"
                                         Ticks="{TemplateBinding Ticks}"/>
                                <!-- 轨道 -->
                                <Border Grid.Row="1" Height="4" CornerRadius="2" Background="#DDD" VerticalAlignment="Center"/>
                                <!-- Track -->
                                <Track x:Name="PART_Track"
                                       Grid.Row="1"
                                       VerticalAlignment="Center">
                                    <Track.Thumb>
                                        <Thumb Width="18" Height="18">
                                            <Thumb.Template>
                                                <ControlTemplate TargetType="Thumb">
                                                    <Ellipse Width="18" Height="18" Fill="White">
                                                        <Ellipse.Effect>
                                                            <DropShadowEffect BlurRadius="5" ShadowDepth="1" Opacity="0.3"/>
                                                        </Ellipse.Effect>
                                                    </Ellipse>
                                                </ControlTemplate>
                                            </Thumb.Template>
                                        </Thumb>
                                    </Track.Thumb>
                                </Track>
                                <!-- Bottom TickBar（如需显示底部刻度）-->
                                <TickBar x:Name="BottomTick"
                                         Grid.Row="2"
                                         Fill="#888"
                                         Placement="Bottom"
                                         Height="4"
                                         SnapsToDevicePixels="True"
                                         Minimum="{TemplateBinding Minimum}"
                                         Maximum="{TemplateBinding Maximum}"
                                         TickFrequency="{TemplateBinding TickFrequency}"
                                         IsDirectionReversed="{TemplateBinding IsDirectionReversed}"
                                         Ticks="{TemplateBinding Ticks}"/>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ComboBox 无边框无背景样式 -->
            <Style TargetType="ComboBox">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="BorderBrush" Value="Transparent"/>
            </Style>

            <!-- 列宽资源 -->
            <system:Double x:Key="ColWidth_Delete">30</system:Double>
            <system:Double x:Key="ColWidth_Visible">30</system:Double>
            <system:Double x:Key="ColWidth_Color">25</system:Double>
            <system:Double x:Key="ColWidth_Name">120</system:Double>
            <system:Double x:Key="ColWidth_Width">80</system:Double>
            <system:Double x:Key="ColWidth_Opacity">80</system:Double>
            <system:Double x:Key="ColWidth_LineStyle">60</system:Double>
            <system:Double x:Key="ColWidth_SourceFile">300</system:Double>
            <system:Double x:Key="ColWidth_Operation">50</system:Double>
            <system:Double x:Key="ColWidth_OtherCurve">100</system:Double>
            <system:Double x:Key="ColWidth_XMagnitude">40</system:Double>
            <system:Double x:Key="ColWidth_Reverse">40</system:Double>
        </ResourceDictionary>
    </Window.Resources>
    
    <Grid x:Name="MainGrid">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="250"/>
        </Grid.ColumnDefinitions>

        <!-- 调色板Popup，放在这里 -->
        <Popup x:Name="ColorPickerPopup" StaysOpen="False" Placement="MousePoint" AllowsTransparency="True">
            <Border Background="#802b2b2b" BorderThickness="0" Padding="2">
                <UniformGrid x:Name="ColorGrid" Rows="6" Columns="6"/>
            </Border>
        </Popup>

        <!-- 关于信息Popup -->
        <Popup x:Name="AboutPopup" StaysOpen="False" Placement="MousePoint" AllowsTransparency="True">
            <Border Background="#EE2b2b2b" BorderThickness="0" Padding="10">
                <StackPanel>
                    <TextBlock Text="{DynamicResource WindowTitle}" FontSize="16" FontWeight="Bold" Foreground="White" Margin="0,0,0,10"/>
                    <TextBlock Text="{DynamicResource Version}" Foreground="White" Margin="0,0,0,5"/>
                    <TextBlock Text="{DynamicResource Author}" Foreground="White" Margin="0,0,0,5"/>
                    <TextBlock Text="{DynamicResource Email}" Foreground="White" Margin="0,0,0,5"/>
                    <TextBlock Text="{DynamicResource Date}" Foreground="White"/>
                </StackPanel>
            </Border>
        </Popup>
        
        
        <!-- 左侧工具栏 -->
        <Grid Grid.Column="0" Background="#fff9f9f9" Width="45" Margin="0,0,10,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <StackPanel Orientation="Vertical" Grid.Row="0">
                <Button x:Name="OpenFileButton" 
                        Click="OpenFileButton_Click"
                        ToolTip="{DynamicResource OpenFile}" 
                        Style="{StaticResource ToolbarButtonStyle}" 
                        Margin="0,20,0,20">
                    <Image Source="pack://application:,,,/assets/icon_open.png"/>
                </Button>
                <Button x:Name="SaveImageButton"
                        Click="SaveImageButton_Click"
                        ToolTip="{DynamicResource SaveImage}" 
                        Style="{StaticResource ToolbarButtonStyle}" 
                        Margin="0,0,0,20">
                    <Image Source="pack://application:,,,/assets/icon_save.png"/>
                </Button>
                <Button x:Name="ZoomResetButton"
                        Click="ZoomResetButton_Click"
                        ToolTip="{DynamicResource ZoomReset}" 
                        Style="{StaticResource ToolbarButtonStyle}"
                        Margin="0,0,0,20">
                    <Image Source="pack://application:,,,/assets/icon_zoom_reset.png"/>
                </Button>
                <Button x:Name="TableButton" 
                        Style="{StaticResource ToolbarButtonStyle}"
                        Click="OnTableClick"
                        ToolTip="{DynamicResource ShowTable}"
                        Margin="0,0,0,20">
                    <Image Source="pack://application:,,,/assets/icon_table.png"/>
                </Button>
            </StackPanel>
            <Button x:Name="AboutButton"
                    Style="{StaticResource ToolbarButtonStyle}"
                    Click="OnAboutPopupClick"
                    ToolTip="{DynamicResource About}"
                    Margin="0,0,0,20"
                    Grid.Row="1"
                    VerticalAlignment="Bottom">
                <Image Source="pack://application:,,,/assets/icon_about.png"/>
            </Button>
        </Grid>

        <!-- 中间图表区域 -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- 区域A：图表区域 -->
            <Border Grid.Row="0" BorderBrush="#DDDDDD" BorderThickness="0,0,0,1">
                <scott:WpfPlot x:Name="PlotView" Margin="10"/>
            </Border>

            <!-- 重复数据提示Toast -->
            <Border x:Name="DuplicateCurveToast"
                    Background="#EE2b2b2b"
                    CornerRadius="3"
                    Padding="20"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Top"
                    Margin="0,30,0,0"
                    Visibility="Collapsed"
                    Panel.ZIndex="999">
                <TextBlock Text="{DynamicResource DuplicateCurveToast}" FontSize="16" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center"/>
            </Border>

            <!-- 分隔条 -->
            <GridSplitter Grid.Row="1" 
                         Height="3" 
                         HorizontalAlignment="Stretch" 
                         VerticalAlignment="Center"
                         Background="#EEEEEE"
                         ResizeDirection="Rows"/>

            <!-- 区域B： -->
            <Grid x:Name="BGrid" Grid.Row="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="110"/>
                </Grid.RowDefinitions>
                
                <!-- 区域B-1：上部分 -->
                <Border Grid.Row="0" BorderBrush="#DDDDDD" BorderThickness="0,0,0,1">
                    <Grid>
                        <ListView x:Name="CurveListView"
                                  ItemsSource="{Binding CurveInfos}"
                                  AllowDrop="True"
                                  Margin="10"
                                  HorizontalAlignment="Stretch"
                                  VerticalAlignment="Stretch"
                                  SelectionMode="Single"
                                  PreviewMouseLeftButtonDown="CurveListView_PreviewMouseLeftButtonDown"
                                  MouseMove="CurveListView_MouseMove"
                                  Drop="CurveListView_Drop"
                                  DragOver="CurveListView_DragOver">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Width="{StaticResource ColWidth_Delete}">
                                        <GridViewColumn.Header>
                                            <Button Click="ClearAllButton_Click"
                                                    ToolTip="{DynamicResource ClearAll}"
                                                    Padding="2,0"
                                                    Background="Transparent"
                                                    BorderThickness="0">
                                                <Image Source="pack://application:,,,/assets/icon_clear.png"
                                                       Width="16" Height="16"
                                                       RenderOptions.BitmapScalingMode="HighQuality"/>
                                            </Button>
                                        </GridViewColumn.Header>
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button Content="×" Click="DeleteCurveButton_Click" Tag="{Binding}" Foreground="Red" Padding="0" Width="24"
                                                        Background="Transparent" BorderThickness="0" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="" Width="{StaticResource ColWidth_Visible}">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding Visible, Mode=TwoWay}" VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="" Width="{StaticResource ColWidth_Color}">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <Border Width="20" Height="20" Background="{Binding Brush}" Cursor="Hand"
                                                        MouseLeftButtonDown="OnCurveColorBlockPressed"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="{DynamicResource Name}" Width="{StaticResource ColWidth_Name}">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBox Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                         BorderThickness="0"
                                                         Background="Transparent"
                                                         VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="{DynamicResource Width}" Width="{StaticResource ColWidth_Width}">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <Slider Minimum="1" Maximum="17" TickFrequency="4" IsSnapToTickEnabled="True" Value="{Binding Width, Mode=TwoWay}" Width="60"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="{DynamicResource Opacity}" Width="{StaticResource ColWidth_Opacity}">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <Slider Minimum="0.0" Maximum="1.0" Value="{Binding Opacity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        Width="60" TickFrequency="0.2" IsSnapToTickEnabled="True"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="{DynamicResource LineStyle}" Width="{StaticResource ColWidth_LineStyle}">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <ComboBox SelectedValue="{Binding LineStyle, Mode=TwoWay}" 
                                                          SelectedValuePath="Content"
                                                          Width="50"
                                                          Background="Red">
                                                    <ComboBoxItem Content=" ——  "/>
                                                    <ComboBoxItem Content=" — —"/>
                                                    <ComboBoxItem Content=" - - - -"/>
                                                    <ComboBoxItem Content=" . . . . ."/>
                                                </ComboBox>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="{DynamicResource SourceFile}" Width="{StaticResource ColWidth_SourceFile}">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding SourceFileName}" FontSize="12">
                                                    <TextBlock.ToolTip>
                                                        <ToolTip>
                                                            <TextBlock Text="{Binding SourceFileTooltip}" FontSize="12"/>
                                                        </ToolTip>
                                                    </TextBlock.ToolTip>
                                                </TextBlock>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="{DynamicResource Operation}" Width="{StaticResource ColWidth_Operation}">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <ComboBox SelectedValue="{Binding OperationType, Mode=TwoWay}" 
                                                          SelectedValuePath="Content"
                                                          Width="60">
                                                    <ComboBoxItem Content="{DynamicResource OperationNone}"/>
                                                    <ComboBoxItem Content="-"/>
                                                </ComboBox>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="{DynamicResource OtherCurve}" Width="{StaticResource ColWidth_OtherCurve}">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <ComboBox Width="90"
                                                          ItemsSource="{Binding OtherCurves}"
                                                          SelectedItem="{Binding TargetCurve, Mode=TwoWay}"
                                                          DisplayMemberPath="Name"
                                                          IsEnabled="{Binding IsTargetCurveEnabled}">
                                                    <ComboBox.ItemTemplate>
                                                        <DataTemplate>
                                                            <TextBlock Text="{Binding Name}"/>
                                                        </DataTemplate>
                                                    </ComboBox.ItemTemplate>
                                                </ComboBox>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Width="{StaticResource ColWidth_XMagnitude}">
                                        <GridViewColumn.Header>
                                            <TextBlock>
                                                10<Run BaselineAlignment="Superscript">n</Run>
                                            </TextBlock>
                                        </GridViewColumn.Header>
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBox Text="{Binding XMagnitude, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                         VerticalAlignment="Center" 
                                                         HorizontalContentAlignment="Center"
                                                         BorderThickness="0"
                                                         Background="Transparent"
                                                         Width="{StaticResource ColWidth_XMagnitude}"
                                                         PreviewTextInput="OnXMagnitudePreviewTextInput"
                                                         ToolTip="{DynamicResource XMagnitudeTip}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="{DynamicResource Reverse}" Width="{StaticResource ColWidth_Reverse}">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding ReverseX, Mode=TwoWay}" VerticalAlignment="Center" HorizontalAlignment="Center" ToolTip="{DynamicResource ReverseTip}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </Border>

                <!-- 区域B-2：下部分 -->
                <Grid Grid.Row="1">
                    <StackPanel Margin="10">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="{DynamicResource XAxisLabel}" VerticalAlignment="Center" Width="60"/>
                            <TextBox x:Name="XAxisLabelTextBox" Width="200" Padding="5,2"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="{DynamicResource YAxisLabel}" VerticalAlignment="Center" Width="60"/>
                            <TextBox x:Name="YAxisLabelTextBox" Width="200" Padding="5,2"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Width:" VerticalAlignment="Center" Width="60"/>
                            <TextBox x:Name="ImageWidthTextBox" Width="80" Padding="5,2" Text="1500" Margin="0,0,10,0" PreviewTextInput="OnImageResolutionPreviewTextInput"/>
                            <TextBlock Text="Height:" VerticalAlignment="Center" Width="60"/>
                            <TextBox x:Name="ImageHeightTextBox" Width="80" Padding="5,2" Text="1000" PreviewTextInput="OnImageResolutionPreviewTextInput"/>
                            <TextBlock Text="{DynamicResource LegendPosition}" VerticalAlignment="Center" Width="60" Margin="20,0,0,0"/>
                            <ComboBox x:Name="LegendPositionComboBox" Width="80" Padding="5,2" SelectedIndex="0" SelectionChanged="LegendPositionComboBox_SelectionChanged">
                                <ComboBoxItem Content="{DynamicResource LegendLowerLeft}"/>
                                <ComboBoxItem Content="{DynamicResource LegendUpperLeft}"/>
                                <ComboBoxItem Content="{DynamicResource LegendLowerRight}"/>
                                <ComboBoxItem Content="{DynamicResource LegendUpperRight}"/>
                            </ComboBox>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>

        <!-- 右侧调试区域 -->
        <Grid Grid.Column="2" Background="#F5F5F5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- 调试区域标题栏 -->
            <Border Background="#E0E0E0" Padding="5">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{DynamicResource DebugInfo}" FontWeight="Bold"/>
                    <Button x:Name="ClearDebugButton" 
                            Content="{DynamicResource Clear}" 
                            Margin="10,0,0,0" 
                            Padding="5,2"
                            Click="ClearDebugButton_Click"/>
                    <Button x:Name="CopyDebugButton" 
                            Content="{DynamicResource Copy}" 
                            Margin="5,0,0,0" 
                            Padding="5,2"
                            Click="CopyDebugButton_Click"/>
                </StackPanel>
            </Border>

            <!-- 调试信息文本框 -->
            <TextBox x:Name="DebugTextBox"
                     Grid.Row="1"
                     IsReadOnly="True"
                     TextWrapping="Wrap"
                     VerticalScrollBarVisibility="Auto"
                     HorizontalScrollBarVisibility="Auto"
                     FontFamily="Consolas"
                     FontSize="12"
                     Padding="5"
                     Background="White"
                     BorderThickness="0"/>
        </Grid>
    </Grid>
</Window> 